# devops-netology  
Home work 06-db-06-troobleshooting

Домашнее задание к занятию "6.6. Troubleshooting"
Задача 1
Перед выполнением задания ознакомьтесь с документацией по администрированию MongoDB.

Пользователь (разработчик) написал в канал поддержки, что у него уже 3 минуты происходит CRUD операция в MongoDB и её нужно прервать.

Вы как инженер поддержки решили произвести данную операцию:

напишите список операций, которые вы будете производить для остановки запроса пользователя
предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB

````
1) Используя db.currentOp() определить идентификатор проблемной операции  
2) Завершить соотв. операцию с помощью db.killOp()  

При определении варианта решения проблемы с долгими запросами, необходимо отталкиваться от типа запроса:
1. Если это запрос на чтение, то уточнить возможность чтения с реплик.
2. Если это запрос на изменение/запись, то проверить настройки, влияющие на durability
````

Задача 2
Перед выполнением задания познакомьтесь с документацией по Redis latency troobleshooting.

Вы запустили инстанс Redis для использования совместно с сервисом, который использует механизм TTL. Причем отношение количества записанных key-value значений к количеству истёкших значений есть величина постоянная и увеличивается пропорционально количеству реплик сервиса.

При масштабировании сервиса до N реплик вы увидели, что:

сначала рост отношения записанных значений к истекшим
Redis блокирует операции записи
Как вы думаете, в чем может быть проблема?

````
Рост отношения записанных значений к истекшим, совместно с блокировкой записи, косвенно указывает на 
"Latency generated by expires" из Redis latency troobleshooting

````

Задача 3
Вы подняли базу данных MySQL для использования в гис-системе. При росте количества записей, в таблицах базы, пользователи начали жаловаться на ошибки вида:

InterfaceError: (InterfaceError) 2013: Lost connection to MySQL server during query u'SELECT..... '
Как вы думаете, почему это начало происходить и как локализовать проблему?
````
Не указано, через какое время после начала выполнения запроса возникает ошибка и в каком % попыток выполнения она возникает, а это сразу помогло бы в локализации.
Может быть ряд причин, приводящих к подобной ошибке, необходимо более детальное исследование, 
но вот основные из них, с соотв мерами по локализации: 
1. Проблема на уровне сетевого соединения. Провести соотв тесты, убедиться в отсутствии потерь пакетов в сети и иных проблем
2. Проблема на уровне системных ресурсов. Убедиться в достаточности памяти, процессорного времени, скорости дисковой подсистемы.
3. Проблема на уровне кода ПО. Проанализировать состав запроса на предмет его оптимальности. 
   Возможно, переработанный или разбитый на несколько других, запрос будет работать без ошибок на возросшем числе записей.
4. Проблема на уровне настроек СУБД. Проанализировать и скорректировать параметры, влияющие на быстродействие и таймауты.
5. Проблема на уровне самой БД. Проверить актуальность и корректность индексов в таблицах, которые использует запрос.

````

Какие пути решения данной проблемы вы можете предложить?

Задача 4
Вы решили перевести гис-систему из задачи 3 на PostgreSQL, так как прочитали в документации, что эта СУБД работает с большим объемом данных лучше, чем MySQL.

После запуска пользователи начали жаловаться, что СУБД время от времени становится недоступной. В dmesg вы видите, что:

postmaster invoked oom-killer

Как вы думаете, что происходит?
````
Ядру ОС в моменте не хватает памяти и освободить ее другими способами невозможно, по ряду критериев выбирается процесс, 
работа которого будет завершена для продолжения работы ОС в целом.  
````

Как бы вы решили данную проблему?
````
Необходимо привести в соответствие объем памяти и ее потребление.
Возможные способы и их комбинации:
1. Увеличение объема памяти
2. Ограничение потребления памяти процессами в системе, в т.ч. PostgreSQL с помощью изменения соотв. параметров конфигурации
3. Отключить OOM-Killer (не рекомендуется)

````